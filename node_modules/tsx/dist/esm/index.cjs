"use strict";var S=Object.defineProperty;var p=(e,t)=>S(e,"name",{value:t,configurable:!0});var F=require("node:worker_threads"),f=require("../node-features-roYmp9jK.cjs"),N=require("../register-B3wWjxbN.cjs");require("../get-pipe-path-BoR10qr8.cjs"),require("node:module");var R=require("node:path"),w=require("node:url");require("get-tsconfig");var q=require("node:fs");require("esbuild"),require("node:crypto");var g=require("../index-BWOq89IJ.cjs"),T=require("../client-D6NvIMSC.cjs"),i=require("../register-DIqrWwRV.cjs");require("../require-Bjmzt-5f.cjs");var j=require("node:fs/promises");require("module"),require("../temporary-directory-B83uKxJF.cjs"),require("node:os"),require("node:net");const d={active:!0},O=p(async e=>{if(!e)throw new Error(`tsx must be loaded with --import instead of --loader
The --loader flag was deprecated in Node v20.6.0 and v18.19.0`);d.namespace=e.namespace,e.tsconfig!==!1&&i.loadTsconfig(e.tsconfig??process.env.TSX_TSCONFIG_PATH),e.port&&(d.port=e.port,e.port.on("message",t=>{t==="deactivate"&&(d.active=!1,e.port.postMessage({type:"deactivated"}))}))},"initialize"),v=p(()=>(i.loadTsconfig(process.env.TSX_TSCONFIG_PATH),"process.setSourceMapsEnabled(true);"),"globalPreload"),h=new Map,M=p(async e=>{if(h.has(e))return h.get(e);if(!await q.promises.access(e).then(()=>!0,()=>!1)){h.set(e,void 0);return}const n=await q.promises.readFile(e,"utf8");try{const o=JSON.parse(n);return h.set(e,o),o}catch{throw new Error(`Error parsing: ${e}`)}},"readPackageJson"),L=p(async e=>{let t=new URL("package.json",e);for(;!t.pathname.endsWith("/node_modules/package.json");){const n=w.fileURLToPath(t),o=await M(n);if(o)return o;const a=t;if(t=new URL("../package.json",t),t.pathname===a.pathname)break}},"findPackageJson"),D=p(async e=>(await L(e))?.type??"commonjs","getPackageType"),J=p(e=>{[e]=e.split("?");const t=R.extname(e);if(t===".json")return"json";if(t===".mjs"||t===".mts")return"module";if(t===".cjs"||t===".cts")return"commonjs"},"getFormatFromExtension"),$=p(e=>{const t=J(e);if(t)return t;if(i.tsExtensionsPattern.test(e))return D(e)},"getFormatFromFileUrl"),l="tsx-namespace=",y=p(e=>{const t=e.indexOf(l);if(t===-1)return;const n=e[t-1];if(n!=="?"&&n!=="&")return;const o=t+l.length,a=e.indexOf("&",o);return a===-1?e.slice(o):e.slice(o,a)},"getNamespace"),P=f.isFeatureSupported(f.importAttributes)?"importAttributes":"importAssertions",A=p(async(e,t,n)=>{if(!d.active)return n(e,t);const o=y(e);if(d.namespace&&d.namespace!==o)return n(e,t);if(d.port){const r=new URL(e);r.searchParams.delete("tsx-namespace"),d.port.postMessage({type:"load",url:r.toString()})}T.parent.send&&T.parent.send({type:"dependency",path:e}),i.isJsonPattern.test(e)&&(t[P]||(t[P]={}),t[P].type="json");const a=await n(e,t),u=e.startsWith("file://")?w.fileURLToPath(e):e;if(a.format==="commonjs"&&f.isFeatureSupported(f.esmLoadReadFile)&&a.responseURL?.startsWith("file:")&&!u.endsWith(".cjs")){const r=await j.readFile(new URL(e),"utf8");if(!u.endsWith(".js")||g.isESM(r)){const c=g.transformSync(r,u,{tsconfigRaw:i.fileMatcher?.(u)}),m=new URLSearchParams({filePath:u});return o&&m.set("namespace",o),a.responseURL=`data:text/javascript,${encodeURIComponent(c.code)}?${m.toString()}`,a}}if(!a.source)return a;const s=a.source.toString();if(a.format==="json"||i.tsExtensionsPattern.test(e)){const r=await g.transform(s,u,{tsconfigRaw:i.fileMatcher?.(u)});return{format:"module",source:i.inlineSourceMap(r)}}if(a.format==="module"){const r=g.transformDynamicImport(u,s);r&&(a.source=i.inlineSourceMap(r))}return a},"load"),_=p(async e=>(!e.format&&e.url.startsWith(i.fileUrlPrefix)&&(e.format=await $(e.url)),e),"resolveMissingFormat"),I=[".js",".json",".ts",".tsx",".jsx"],E=p(async(e,t,n)=>{const[o,a]=e.split("?");let u;for(const s of I)try{return await _(await n(o+s+(a?`?${a}`:""),t))}catch(r){if(u===void 0&&r instanceof Error){const{message:c}=r;r.message=r.message.replace(`${s}'`,"'"),r.stack=r.stack.replace(c,r.message),u=r}}throw u},"tryExtensions"),k=p(async(e,t,n)=>{const o=i.isDirectoryPattern.test(e),a=o?"index":"/index",[u,s]=e.split("?");try{return await E(u+a+(s?`?${s}`:""),t,n)}catch(r){if(!o)try{return await E(e,t,n)}catch{}const c=r,{message:m}=c;throw c.message=c.message.replace(`${a.replace("/",R.sep)}'`,"'"),c.stack=c.stack.replace(m,c.message),c}},"tryDirectory"),U=p(async(e,t,n,o)=>{if(!d.active)return n(e,t);const a=t.parentURL&&y(t.parentURL);if(i.requestAcceptsQuery(e)){let s=y(e);if(a&&!s&&(s=a,e+=`${e.includes("?")?"&":"?"}${l}${a}`),d.namespace&&d.namespace!==s)return n(e,t);if(i.isDirectoryPattern.test(e))return await k(e,t,n)}else if(i.tsconfigPathsMatcher&&!t.parentURL?.includes("/node_modules/")){const s=i.tsconfigPathsMatcher(e);for(const r of s)try{return await U(w.pathToFileURL(r).toString(),t,n)}catch{}}if((e.startsWith("#")||!i.isBarePackageName.test(e))&&(i.tsExtensionsPattern.test(t.parentURL)||i.allowJs)){const s=i.resolveTsPath(e);if(s)for(const r of s)try{return await _(await n(r,t))}catch(c){const{code:m}=c;if(m!=="ERR_MODULE_NOT_FOUND"&&m!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw c}}try{const s=await _(await n(e,t));if(i.requestAcceptsQuery(s.url)){const r=y(s.url);a&&!r&&(s.url+=`${s.url.includes("?")?"&":"?"}${l}${a}`)}return s}catch(s){if(s instanceof Error&&!o){const{code:r}=s;if(r==="ERR_UNSUPPORTED_DIR_IMPORT")try{return await k(e,t,n)}catch(c){if(c.code!=="ERR_PACKAGE_IMPORT_NOT_DEFINED")throw c}if(r==="ERR_MODULE_NOT_FOUND")try{return await E(e,t,n)}catch{}}throw s}},"resolve");f.isFeatureSupported(f.moduleRegister)&&F.isMainThread&&N.register(),exports.globalPreload=v,exports.initialize=O,exports.load=A,exports.resolve=U;
